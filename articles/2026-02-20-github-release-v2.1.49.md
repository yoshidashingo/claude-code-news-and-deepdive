---
title: "Claude Code v2.1.49 リリース — メモリリーク修正・起動高速化・ConfigChange フック追加"
date: 2026-02-20
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.49"
identifier: "v2.1.49"
---

# Claude Code v2.1.49 リリース — メモリリーク修正・起動高速化・ConfigChange フック追加

## 概要

Claude Code v2.1.49 がリリースされました。長時間セッション中の WASM メモリ無制限増大を修正する重要なバグ修正を含むほか、起動パフォーマンスの複数改善、エンタープライズ向けの `ConfigChange` フックイベント追加など、安定性と運用性の向上に重点を置いたアップデートです。また、Max プランにおいて Sonnet 4.5（1M コンテキスト）が Sonnet 4.6（1M コンテキスト）へ置き換えられるモデル変更も含まれています。

## 新機能

### ConfigChange フックイベントの追加

設定ファイルが変更されるたびに発火する `ConfigChange` フックイベントが追加されました。エンタープライズ環境でのセキュリティ監査に活用でき、設定変更のトラッキングや、必要に応じてポリシー違反となる変更のブロックが可能になります。

```json
{
  "hooks": {
    "ConfigChange": [
      {
        "matcher": "",
        "hooks": [
          { "type": "command", "command": "your-audit-script.sh" }
        ]
      }
    ]
  }
}
```

### SDK モデル情報の拡張

SDK のモデル情報に以下の 3 フィールドが追加されました。SDK 利用者がプログラム的にモデルの能力を確認できるようになります。

- `supportsEffort` — effort レベルの設定をサポートするかどうか
- `supportedEffortLevels` — サポートする effort レベルの一覧
- `supportsAdaptiveThinking` — adaptive thinking をサポートするかどうか

### シンプルモードへのファイル編集ツール追加

`CLAUDE_CODE_SIMPLE` 環境変数で有効化するシンプルモードに、これまでの Bash ツールに加えてファイル編集ツールが追加されました。シンプルモードでもファイルの直接編集が可能になります。

### パーミッション提案の表示改善

セーフティチェックによってアスク応答がトリガーされた際、パーミッション提案が表示されるようになりました。SDK 利用者がユーザーに対してパーミッションオプションを提示できるようになります。

## 改善点

### 起動パフォーマンスの大幅改善

複数の施策により、Claude Code の起動速度が向上しました。

- **MCP 認証失敗のキャッシング** — HTTP および SSE MCP サーバーへの認証が必要なサーバーへの重複接続試行を回避します。
- **MCP ツールのトークンカウントをバッチ処理** — 個別に行っていた API 呼び出しを 1 回のバッチ呼び出しにまとめます。
- **アナリティクス用 HTTP 呼び出しの削減** — トークンカウンティングに関連する不要な HTTP リクエストを削減します。
- **非対話モード（`-p`）の最適化** — 起動時に不要な API 呼び出しをスキップします。

### 権限プロンプトの情報改善

パス安全性チェックやワーキングディレクトリ制限によってブロックされた場合、制限の理由が権限プロンプトに表示されるようになりました。これまでは文脈のない bare なプロンプトが表示されていたため、ユーザーが状況を把握しにくい問題がありました。

### `disableAllHooks` 設定の階層尊重

管理設定（ポリシーで設定されたフック）が `disableAllHooks` によって上書きされてしまう問題が修正されました。管理対象外の設定からは、管理ポリシーで設定されたフックを無効化できなくなります（issue #26637 対応）。

## バグ修正

### Ctrl+C / ESC がバックグラウンドエージェント実行中に無視される問題

バックグラウンドエージェントが実行中でメインスレッドがアイドル状態のとき、Ctrl+C と ESC が無視されていた問題を修正しました。3 秒以内に 2 回押すと、すべてのバックグラウンドエージェントを終了させるようになります。

### WASM メモリの無制限増大（重要）

長時間セッション中に Yoga WASM のリニアメモリが縮小されないことによる、メモリ使用量の際限ない増大が修正されました。tree-sitter パーサーを定期的にリセットすることでメモリ増大を防止します。また、古い Yoga レイアウト参照に起因するレンダリング問題も併せて修正されています。

### プロンプト提案キャッシュの回帰

キャッシュヒット率が低下する回帰バグが修正されました。

### プラグインスコープの自動検出

`plugin enable` および `plugin disable` コマンドで `--scope` を指定しない場合、常にユーザースコープへデフォルトされていた問題を修正しました。適切なスコープを自動検出するようになります。

### 詳細モードの思考ブロック表示

`/config` から詳細（verbose）モードを切り替えた際に、思考ブロックの表示が更新されない問題を修正しました。メモ比較子が verbose の変更を正しく検出するようになります。

### `--resume` セッションピッカーでの XML タグ表示

`/clear` などのコマンドで始まるセッションを `--resume` のセッションピッカーで表示した際、生の XML タグが表示されていた問題を修正しました。セッション ID フォールバックへ正しく移行するようになります。

## モデル変更（Breaking Change に近い注意事項）

**Max プランにおいて Sonnet 4.5（1M コンテキスト）が廃止されます。** Sonnet 4.6 がフロンティアモデルとして 1M コンテキストをサポートするようになったため、Max プランから Sonnet 4.5（1M コンテキスト）が削除されます。

現在このモデルを使用している場合は、`/model` コマンドで Sonnet 4.6 への切り替えが必要です。

```
/model
```

## 技術的なポイント

- **WASM メモリ管理** — Yoga および tree-sitter の WASM ランタイムは、長時間セッションで意図せずメモリを保持し続ける特性がある。定期的なパーサーリセットによる緩和策が導入された。
- **MCP 認証キャッシング** — 認証が必要なサーバーへの接続失敗結果をキャッシュすることで、起動ごとに発生していた重複リクエストを排除。エンタープライズ環境で多数の MCP サーバーを構成している場合に特に効果的。
- **ConfigChange フック** — `PreToolUse` や `PostToolUse` と同様のフック機構を設定変更イベントに適用。設定ファイルの変更監視をシェルスクリプト等で実装できる。
- **SDK の `supportsAdaptiveThinking`** — 拡張思考（extended thinking）のモデルサポートをランタイムで確認できるため、SDK 上に構築するアプリケーションが対応モデルを動的に検出できる。
- **`disableAllHooks` の修正** — 管理ポリシーによるフックがユーザー設定で無効化できてしまうセキュリティ上の懸念に対応。エンタープライズ展開での信頼性が向上。

## まとめ

v2.1.49 は、長時間稼働環境での安定性（WASM メモリリーク修正）と起動パフォーマンスの向上を中心としたリリースです。エンタープライズ利用者には `ConfigChange` フックと `disableAllHooks` の修正が重要な改善点となります。また、Max プランユーザーは Sonnet 4.5（1M コンテキスト）から Sonnet 4.6 への移行が必要となるため、`/model` コマンドでの確認を忘れずに行ってください。SDK 開発者にとっては、新しいモデル能力フィールドによって、よりインテリジェントなモデル選択ロジックを実装できる基盤が整いました。
