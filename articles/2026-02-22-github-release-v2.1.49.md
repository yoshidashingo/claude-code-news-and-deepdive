---
title: "Claude Code v2.1.49 リリース — メモリリーク修正、パフォーマンス改善、ConfigChange フック追加"
date: 2026-02-22
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.49"
identifier: "v2.1.49"
---

# Claude Code v2.1.49 リリース — メモリリーク修正、パフォーマンス改善、ConfigChange フック追加

## 概要

Claude Code v2.1.49 がリリースされました。このリリースでは、長時間セッションでの WASM メモリリークを修正する重要なバグ修正が含まれています。また、起動パフォーマンスの大幅な改善、エンタープライズ向けの `ConfigChange` フックイベントの追加、SDK の機能情報拡充など多岐にわたる改善が施されています。さらに、Max プランで Sonnet 4.5（1M context）が廃止され、Sonnet 4.6（1M context）へ移行する重要な変更もあります。

## 新機能

### ConfigChange フックイベント

設定ファイルが変更された際に発火する新しい `ConfigChange` フックイベントが追加されました。これはエンタープライズ環境でのセキュリティ監査に対応するためのもので、設定変更のモニタリングや必要に応じた変更のブロックが可能になります。

```json
{
  "hooks": {
    "ConfigChange": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'Config changed' >> /var/log/claude-audit.log"
          }
        ]
      }
    ]
  }
}
```

組織のセキュリティポリシーの観点から、設定変更を追跡・制御したい場合に有用な機能です。

### SDK のモデル機能情報拡充

SDK のモデル情報に新しいフィールドが追加されました。

- `supportsEffort`: effort レベルの設定が可能かどうか
- `supportedEffortLevels`: 対応している effort レベルの一覧
- `supportsAdaptiveThinking`: Adaptive Thinking 機能への対応可否

SDK 消費者（SDK consumers）がモデルの機能を動的に検出できるようになり、対応機能に応じた UI の出し分けや処理の分岐が容易になります。

### Simple モードへのファイル編集ツール追加

`CLAUDE_CODE_SIMPLE` 環境変数で有効化される Simple モードに、これまでの Bash ツールに加えてファイル編集ツールが追加されました。Simple モードでも直接ファイル編集が行えるようになり、用途が広がります。

### パーミッション提案の改善

セーフティチェックが ask レスポンスをトリガーした際に、パーミッション提案が表示されるようになりました。SDK 消費者がパーミッションオプションをユーザーに提示しやすくなります。

## 改善点

### 起動パフォーマンスの大幅改善

v2.1.49 では起動時のパフォーマンス改善が複数施されています。

- **MCP 認証失敗キャッシング**: HTTP および SSE MCP サーバーへの認証失敗をキャッシュし、認証が必要なサーバーへの再接続試行を回避します。同一の接続試行が繰り返されることで発生していた無駄な待ち時間が削減されます。
- **分析トークンカウントの HTTP 呼び出し削減**: 起動時の analytics token counting に関する HTTP 呼び出しを削減しました。
- **MCP ツールトークンカウントの一括処理**: MCP ツールのトークンカウントを単一の API 呼び出しにまとめることで、起動時のリクエスト数を削減しました。

### 非対話モードのパフォーマンス改善

`-p` フラグで使用する非対話モード（non-interactive mode）において、起動時の不要な API 呼び出しをスキップするようにしました。CI/CD パイプラインや自動化スクリプトでの利用時に恩恵を受けられます。

### パーミッションプロンプトのコンテキスト表示

パス安全性（path safety）や作業ディレクトリブロックによってパーミッションプロンプトが表示される際、制限の理由が明示されるようになりました。これまでは理由の説明のない素のプロンプトが表示されていたため、ユーザーが状況を把握しにくい問題がありました。

## バグ修正

### Ctrl+C / ESC キーの無視問題を修正

バックグラウンドエージェントが実行中でメインスレッドがアイドル状態の場合、`Ctrl+C` および `ESC` キー操作が無視される問題が修正されました。修正後は、**3秒以内に2回押すことで全バックグラウンドエージェントを終了**できるようになります。

### WASM メモリリークの修正（重要）

長時間セッションで発生していた WASM メモリの無制限増加に関するバグが2件修正されました。

- **tree-sitter パーサーの定期リセット**: コード解析に使用する tree-sitter の WASM パーサーが際限なくメモリを消費し続ける問題を、パーサーを定期的にリセットすることで修正しました。
- **Yoga WASM リニアメモリの問題**: レイアウト計算に使用する Yoga の WASM メモリが一度確保されると縮小されない問題を修正しました。

これらは長時間セッションを継続する際に顕在化する問題であり、特に AI エージェントとして長時間稼働させる用途では重要な修正です。

### その他のバグ修正

- **プロンプト提案キャッシュ回帰**: キャッシュヒット率を低下させていたリグレッションを修正しました。
- **`plugin enable` / `plugin disable` のスコープ自動検出**: `--scope` を指定しない場合に常にユーザースコープが使われていた問題を修正し、適切なスコープが自動検出されるようになりました。
- **Verbose モードのシンキングブロック表示**: `/config` で verbose モードを切り替えた際にシンキングブロックの表示が更新されない問題を修正しました。メモ比較処理が verbose の変更を正しく検出するようになりました。
- **stale な Yoga レイアウト参照によるレンダリング問題**: stale な yoga レイアウト参照に起因するレンダリング不具合を修正しました。
- **`--resume` セッションピッカーの XML タグ表示問題**: `/clear` などのコマンドで開始するセッションを `--resume` で再開しようとした際、生の XML タグが表示されていた問題を修正しました。
- **`disableAllHooks` 設定の管理階層尊重**: `disableAllHooks` 設定がポリシーで設定された managed フックを無効化できてしまう問題を修正しました。管理設定階層が正しく機能するようになり、組織のセキュリティポリシーが適切に適用されます。

## Breaking Changes

### Max プラン: Sonnet 4.5 (1M context) の廃止

Max プランから **Sonnet 4.5（1M context）が削除**されます。代替として、同じく 1M context をサポートする **Sonnet 4.6** が利用可能です。Sonnet 4.6 は Anthropic のフロンティアモデルであり、より高い性能が期待できます。

現在 Sonnet 4.5（1M context）を使用している場合は、`/model` コマンドで Sonnet 4.6 へ切り替えてください。

```
/model
```

## 技術的なポイント

- **WASM メモリ管理の難しさ**: tree-sitter と Yoga の2つの WASM モジュールでメモリリークが発見・修正されました。WebAssembly のリニアメモリは一般的に自動縮小されないため、長時間稼働するアプリケーションでは定期的なリセット戦略が重要です。
- **エンタープライズセキュリティの強化**: `ConfigChange` フックと `disableAllHooks` の修正により、組織での管理ポリシー適用がより堅牢になりました。Claude Code を組織規模で運用する際のセキュリティ要件に対応しています。
- **SDK 機能検出の標準化**: `supportsEffort` などのフィールド追加により、SDK 消費者がモデル機能を実行時に検出できるようになりました。異なるモデルを扱う場合の条件分岐をハードコーディングする必要が減ります。
- **MCP サーバー接続のキャッシング**: 認証失敗をキャッシュする設計は、認証設定に問題があるサーバーに対して繰り返し接続を試みることによる起動遅延を防ぐ実用的なアプローチです。
- **非対話モードの最適化**: `-p` フラグ使用時の最適化は、Claude Code を CI/CD で活用するユースケースへの配慮を示しており、自動化ワークフローでの利用がより効率的になります。

## まとめ

v2.1.49 は、長時間セッションでの安定性向上（WASM メモリリーク修正）、起動パフォーマンスの改善、エンタープライズ向け機能の強化（`ConfigChange` フック、managed hooks のポリシー適用）など、実用的な改善が多数含まれたリリースです。

特に長時間稼働するエージェントや、組織での管理下での Claude Code 運用を行っているチームにとって重要なアップデートといえます。Max プランユーザーは Sonnet 4.5（1M context）から Sonnet 4.6 への切り替えが必要なため、早めに `/model` コマンドで対応することをお勧めします。
