---
title: "Claude Code v2.1.47 リリース — Windows 対応強化・パフォーマンス改善・多数のバグ修正"
date: 2026-02-20
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.47"
identifier: "v2.1.47"
---

# Claude Code v2.1.47 リリース — Windows 対応強化・パフォーマンス改善・多数のバグ修正

## 概要

Claude Code v2.1.47 は、Windows 環境での信頼性を大幅に向上させるとともに、起動速度・メモリ使用量・`@` ファイルメンション検索のパフォーマンスを改善した大型メンテナンスリリースです。エージェントのライフサイクル管理に関する新機能も追加され、並行エージェントや長時間セッションでの安定性も向上しています。バグ修正は 50 件を超えており、日常的な開発ワークフローに影響する多くの問題が解消されています。

## 新機能

### バックグラウンドエージェントのキル操作を `ctrl+f` に変更

これまでバックグラウンドエージェントの全終了は ESC の二度押しで行っていましたが、`ctrl+f` キーに変更されました。ESC を一度押した場合はメインスレッドのキャンセルのみ行われ、バックグラウンドエージェントは引き続き実行されます。これによりエージェントのライフサイクルを個別にコントロールしやすくなります。

### フック入力への `last_assistant_message` フィールド追加

`Stop` および `SubagentStop` フックの入力に `last_assistant_message` フィールドが追加されました。フックスクリプトはトランスクリプトファイルを解析せずに最終的なアシスタントの応答テキストにアクセスできるようになります。

```json
{
  "last_assistant_message": "タスクが完了しました。..."
}
```

### `chat:newline` キーバインドアクション

設定可能な複数行入力のために `chat:newline` キーバインドアクションが追加されました。`~/.claude/keybindings.json` でカスタムキーに割り当てることができます。

### statusline JSON に `added_dirs` を追加

statusline JSON の `workspace` セクションに `added_dirs` フィールドが追加されました。`/add-dir` で追加されたディレクトリを外部スクリプトから参照できるようになります。

## 改善点

### VS Code プランプレビューの改善

VS Code 上でのプランプレビューが以下の点で改善されました。

- Claude が反復するたびにプレビューが自動更新されるようになった
- プランのレビュー準備が整った場合にのみコメントが有効化される
- 却下時にもプレビューが開いたままになり、Claude が修正を加えやすくなった

### `@` ファイルメンションのパフォーマンス改善

起動時にインデックスをプリウォームし、セッションベースのキャッシュにバックグラウンド更新を組み合わせることで、`@` ファイルメンション時の候補表示が高速化されました。

### 起動パフォーマンスの改善（約 500ms 短縮）

`SessionStart` フックの実行を遅延させることで、インタラクティブ操作が可能になるまでの時間を約 500ms 短縮しました。

### メモリ使用量の改善

長時間セッションでのメモリ使用量を複数の観点から改善しました。

- API ストリームバッファ・エージェントコンテキスト・スキル状態を使用後に解放
- エージェントタスク完了後にメッセージ履歴をトリミング
- プログレス更新における O(n²) のメッセージ蓄積を解消

### resume ピッカーの初期セッション表示数を 50 に増加

`/resume` コマンドのセッションピッカーが表示する初期セッション数が 10 から 50 に増加し、過去のセッションを素早く見つけられるようになりました。

## バグ修正

### Windows 関連

Windows 環境での安定性・互換性に関する修正が多数含まれています。

- **`os.EOL` (`\r\n`) による表示バグ修正**: 行カウントが常に 1 と表示されていた問題、Markdown 出力で太字・色付きテキストが誤ったキャラクターにシフトされていた問題を修正しました
- **MSYS2 / Cygwin での bash 出力廃棄修正**: MSYS2 または Cygwin シェル使用時に bash ツールの出力が黙って廃棄されていた問題を修正しました
- **CWD 追跡テンプファイルの蓄積修正**: CWD トラッキング用の一時ファイルが無限に蓄積し続けていた問題（#17600）を修正しました
- **フックが cmd.exe で実行失敗する問題修正**: `PreToolUse`・`PostToolUse` フックが Windows で実行されない問題を Git Bash を使用するよう変更することで修正しました（#25981）
- **Right Alt キーのエスケープシーケンス残留修正**: Git Bash ターミナルで Right Alt キー入力後に `[25~` のエスケープシーケンスが入力フィールドに残る問題（#25943）を修正しました
- **ドライブレター大文字小文字の不一致修正**: worktree セッションマッチング・CLAUDE.md の二重読み込みの原因となっていたドライブレターの大文字小文字不一致問題（#25756）を修正しました
- **WSL2 での BMP 形式画像ペースト修正**: Windows が BMP 形式でコピーした画像を WSL2 からペーストできなかった問題（#25935）を修正しました

### セッション・エージェント管理

- **並行エージェントの API 400 エラー修正**: 並行エージェントを使用するセッションで「thinking blocks cannot be modified」エラーが発生していた問題を修正しました
- **`/rename` で設定したセッションタイトルの消失修正**: 会話を再開した後にカスタムタイトルが失われる問題（#23610）を修正しました。またコンテキストコンパクション後にもタイトルが維持されるようになりました（#26121）
- **コンテキストコンパクション後の plan モード消失修正**: コンパクション後に plan モードが失われ、モデルが計画モードから実装モードに切り替わってしまう問題（#26061）を修正しました
- **バックグラウンドエージェントの結果修正**: バックグラウンドエージェントが最終的な回答ではなく生のトランスクリプトデータを返していた問題（#26012）を修正しました
- **`/resume` でセッションが消える問題修正**: 最初のメッセージが 16KB を超える・配列形式コンテンツを持つセッションが `/resume` 時に消える問題（#25721, #25920, #26140）を修正しました
- **`/clear` 後のセッション名残留修正**: `/clear` コマンド実行後もステータスバーにセッション名が残る問題（#26082）を修正しました

### ファイル操作・LSP

- **`FileWriteTool` の末尾空白行修正**: `trimEnd()` によって意図的な末尾空白行が削除されていた問題を修正しました
- **並列ファイル書き込み中の片側エラーによる全停止修正**: 1 つのファイル書き込み・編集エラーが他のすべての並列操作を中断させていた問題を修正しました。独立したファイル操作は兄弟タスクが失敗しても完了するようになりました
- **Unicode curly quotes の破損修正**: Edit ツール使用時に Unicode の curly quote（`"` `"` `'` `'`）が直線のクォートに置き換えられていた問題（#26141）を修正しました
- **LSP `findReferences` が gitignore ファイルを含む問題修正**: `node_modules/`・`venv/` などの gitignore 対象ファイルが参照検索結果に含まれていた問題（#26051）を修正しました

### スキル・エージェント設定

- **カスタムエージェントの `model` フィールド無視修正**: `.claude/agents/*.md` で設定した `model` フィールドがチームメイトのスポーン時に無視されていた問題（#26064）を修正しました
- **git worktree からのエージェント・スキル発見修正**: git worktree から実行した場合にプロジェクトレベルの `.claude/agents/` および `.claude/skills/` が認識されない問題（#25816）を修正しました
- **NFS/FUSE ファイルシステムでのエージェント読み込み修正**: inode をゼロと報告するファイルシステムでユーザー定義エージェントが 1 ファイルしかロードされない問題（#26044）を修正しました
- **スキルの frontmatter 型強制修正**: SKILL.md の `name`・`description` が数値の場合にクラッシュする問題（#25837）や `argument-hint` が YAML sequence 構文の場合に React クラッシュする問題（#25826）を修正しました

### その他

- **PDF 多数含む会話のコンパクション失敗修正**: PDF ドキュメントを多数含む会話でコンパクション API 呼び出しが失敗していた問題（#26188）を修正しました
- **macOS の git FSEvents ループ修正**: 読み取り専用 git コマンドが macOS でファイルウォッチャーのループを引き起こしていた問題（#25750）を `--no-optional-locks` フラグの追加で修正しました
- **CJK 文字によるレイアウトずれ修正**: CJK の全角文字によりタイムスタンプや TUI のレイアウト要素がずれる問題（#26084）を修正しました
- **zsh heredoc の「read-only file system」エラー修正**: サンドボックス化されたコマンドで zsh heredoc が失敗していた問題（#25990）を修正しました
- **`alwaysThinkingEnabled` が Bedrock/Vertex で機能しない修正**: `settings.json` で `alwaysThinkingEnabled: true` を設定しても Bedrock・Vertex プロバイダーで thinking モードが有効にならない問題（#26074）を修正しました
- **bash パーミッション分類器のハルシネーション修正**: 返されたマッチ説明が実際の入力ルールと対応しているかを検証するようにしたことで、ハルシネーションによってパーミッションが誤って付与されることを防ぎます
- **設定バックアップファイルの移動**: ホームディレクトリ直下に保存されていた設定バックアップファイルを `~/.claude/backups/` に移動しました（#26130）

## 技術的なポイント

- **Windows サポートの大幅強化**: `os.EOL` 問題・MSYS2/Cygwin 互換性・フック実行・ドライブレター大文字小文字など、Windows 固有の問題が集中的に修正されています。Windows 環境で Claude Code を利用している開発者は本バージョンへのアップデートを強く推奨します
- **メモリ管理の抜本的改善**: O(n²) のメッセージ蓄積解消・API バッファの即時解放など、長時間セッションを前提としたメモリ効率化が図られています
- **並行エージェントの安定性向上**: 並行ストリーミング中のコンテンツブロック混在に起因する API 400 エラーが修正され、マルチエージェント構成での信頼性が向上しました
- **フックの拡張**: `last_assistant_message` フィールドの追加により、フックスクリプトでの後処理自動化がより柔軟になります。トランスクリプトファイルのパースが不要になります
- **コンテキストコンパクション時の状態保持**: セッション名・plan モードがコンパクション後も維持されるようになり、長期作業中の状態喪失リスクが低減されます
- **`/resume` の大規模セッション対応**: 16KB を超える初期メッセージを持つセッションでの消失問題が複数修正されており、大規模なコンテキストを持つセッションでも安定して再開できるようになりました

## まとめ

v2.1.47 は機能追加よりも品質・安定性の向上に重点を置いたリリースです。特に Windows 環境でのバグが大量に修正されており、クロスプラットフォームでの開発体験が均一化に近づいています。また、長時間・大規模セッションでのメモリ問題やセッション状態の喪失といった実運用上の問題も多数解消されています。

バックグラウンドエージェントのキル操作が `ctrl+f` に変わった点は既存ユーザーが意識すべき動作変更です。`ctrl+f` を別の用途にバインドしている場合は設定の見直しが必要になります。`last_assistant_message` フックフィールドや `chat:newline` キーバインドなどの新機能は、自動化ワークフローを構築している開発者にとって有用な拡張となります。
