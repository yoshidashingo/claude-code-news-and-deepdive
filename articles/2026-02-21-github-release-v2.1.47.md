---
title: "Claude Code v2.1.47 リリース — 大規模バグ修正とパフォーマンス改善"
date: 2026-02-21
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.47"
identifier: "v2.1.47"
---

# Claude Code v2.1.47 リリース — 大規模バグ修正とパフォーマンス改善

## 概要

Claude Code v2.1.47 は、Windows 環境での多数のバグ修正を含む大規模なメンテナンスリリースです。起動パフォーマンスの改善、メモリ使用量の最適化、エージェント・セッション管理の安定性向上など、広範囲にわたる改善が行われています。新機能としてはバックグラウンドエージェントの終了操作変更、フック入力への新フィールド追加、キーバインドのカスタマイズ強化が含まれます。

## 新機能

### バックグラウンドエージェントの制御改善

バックグラウンドエージェントの終了操作が変更されました。これまでの `ESC` キーの二度押しから、**`Ctrl+F`** キーでの一括終了に変更されています。また、メインスレッドをキャンセルするために `ESC` を押してもバックグラウンドエージェントは継続して実行されるようになり、エージェントのライフサイクルをより細かく制御できるようになりました。

チームメイトのナビゲーションも簡略化され、`Shift+Up` と `Shift+Down` の両方を使う操作から、折り返し付きの **`Shift+Down`** のみに統一されました。

### フック入力への `last_assistant_message` フィールド追加

`Stop` および `SubagentStop` フックの入力に `last_assistant_message` フィールドが追加されました。これにより、フックスクリプトがトランスクリプトファイルを解析することなく、最終的なアシスタントの応答テキストに直接アクセスできるようになります。

```json
{
  "hook": "Stop",
  "last_assistant_message": "タスクが完了しました。...",
  ...
}
```

### `chat:newline` キーバインドアクション

複数行入力のための設定可能なキーバインドアクション `chat:newline` が追加されました。`~/.claude/keybindings.json` でカスタマイズできます。

### ステータスライン JSON への `added_dirs` フィールド追加

`/add-dir` で追加されたディレクトリが、ステータスライン JSON の `workspace` セクションに `added_dirs` として公開されるようになりました。外部スクリプトからワークスペースの状態を参照する際に活用できます。

### VS Code プランプレビューの改善

VS Code のプランプレビューが大幅に改善されました。

- Claude が反復作業を行う際にプレビューが自動更新されるようになりました
- プランのレビュー準備が整った時点でのみコメント機能が有効化されます
- プランを却下した際もプレビューが開いたままになり、Claude がプランを修正しやすくなりました

## 改善点

### 起動パフォーマンスの向上（約500ms短縮）

`SessionStart` フックの実行を遅延させることで、インタラクティブになるまでの時間が **約500ms** 短縮されました。

### メモリ使用量の最適化

長時間セッションでのメモリ消費を削減するため、以下の改善が行われました。

- API ストリームバッファ、エージェントコンテキスト、スキルの状態を使用後に解放
- エージェントタスク完了後にメッセージ履歴をトリミング
- 進捗更新における O(n²) のメッセージ蓄積を解消

### `@` ファイルメンションのパフォーマンス向上

ファイルサジェストの表示が高速化されました。起動時にインデックスをウォームアップし、バックグラウンド更新付きのセッションベースキャッシュを使用することで、ファイル候補がより素早く表示されるようになります。

### セッション再開ピッカーの改善

セッション再開ピッカーの初期表示件数が **10件から50件**に増加し、セッションをより素早く見つけられるようになりました。

### `/rename` コマンドの改善

`/rename` コマンドがターミナルのタブタイトルをデフォルトで更新するようになりました。

## バグ修正

### Windows 環境の修正

Windows ユーザーに影響する複数の問題が修正されました。

- **`os.EOL`（`\r\n`）によるターミナルレンダリングバグ**: 行カウントが常に1と表示される問題、Markdown 出力での太字・色付きテキストの文字ずれを修正
- **MSYS2/Cygwin シェルでの Bash ツール出力の欠落**: ツール実行結果がサイレントに破棄される問題を修正
- **`Right Alt` キーの残留エスケープシーケンス**: Git Bash ターミナルで `[25~` が入力フィールドに残る問題を修正
- **CWD トラッキング用一時ファイルのクリーンアップ漏れ**: 無制限に蓄積し続ける問題を修正
- **ワークツリーセッションのドライブレター大小文字の不一致**: 同じ `CLAUDE.md` が二重に読み込まれる問題を修正
- **Windows でのフック（`PreToolUse`、`PostToolUse`）実行失敗**: `cmd.exe` の代わりに Git Bash を使用するよう修正
- **WSL2 での画像ペースト**: Windows が BMP 形式でコピーした画像が貼り付けられない問題を修正

### セッション・コンテキスト管理の修正

- `/resume` で最初のメッセージが 16KB を超えるセッションが見つからない問題を修正
- コンテキスト圧縮後にプランモードが失われる問題を修正
- コンテキスト圧縮後にセッション名（カスタムタイトル）が失われる問題を修正
- `/fork` コマンドで Web 検索を使用したセッションがクラッシュする問題を修正
- PDF ドキュメントが多数含まれる会話でコンパクションが失敗する問題を修正

### エージェント・スキルの修正

- 並列ファイル書き込み/編集操作中に一つのエラーで他の操作も中断される問題を修正（独立したファイル変更は他が失敗しても完了するようになりました）
- 並列エージェント実行中の API 400 エラー（"thinking blocks cannot be modified"）を修正
- バックグラウンドエージェントが最終回答ではなく生のトランスクリプトデータを返す問題を修正
- カスタムエージェントの `model` フィールドがチームメイト生成時に無視される問題を修正
- ゼロ inode を報告する NFS/FUSE ファイルシステムでユーザー定義エージェントが1ファイルしか読み込まれない問題を修正
- プラグインエージェントのスキルがベア名で参照された際にサイレントで読み込み失敗する問題を修正
- スキルの `name`/`description` が数値の場合にクラッシュする問題を修正
- `argument-hint` が YAML シーケンス構文を使用した際の React クラッシュを修正
- Git ワークツリーからカスタムエージェントとスキルが検出されない問題を修正（メインリポジトリの `.claude/agents/` と `.claude/skills/` も参照するよう修正）

### その他の修正

- `bash` パーミッションクラシファイアのハルシネーション防止: 返されたマッチ説明が実際の入力ルールと対応していることを検証するよう修正
- Markdown 内のインラインコードスパンが bash コマンドとして誤って解析される問題を修正
- バックスラッシュ-改行で続く bash コマンドが余分な空引数を生成する問題を修正
- Edit ツールが Unicode のカーリークォート（`""`、`''`）をストレートクォートに置換してしまう問題を修正
- macOS で読み取り専用 git コマンドが FSEvents ファイルウォッチャーのループを引き起こす問題を修正（`--no-optional-locks` フラグを追加）
- CJK（中国語・日本語・韓国語）の全角文字が TUI のタイムスタンプや配置要素のレイアウトを崩す問題を修正
- `claude doctor` が mise/asdf 管理のインストールをネイティブインストールと誤分類する問題を修正
- MCP サーバーが遅延ロード後にダイアログに表示されない問題を修正
- `/clear` コマンド後もステータスバーにセッション名が残る問題を修正
- `alwaysThinkingEnabled: true` が Bedrock/Vertex プロバイダーで機能しない問題を修正
- LSP の `findReferences` が gitignore 対象ファイル（`node_modules/` 等）の結果を返す問題を修正
- 設定バックアップファイルをホームディレクトリのルートから `~/.claude/backups/` に移動
- OSC 8 ハイパーリンクがテキスト折り返し時に最初の行しかクリック可能でない問題を修正

## 技術的なポイント

- **Windows 対応の大幅強化**: `os.EOL` の `\r\n` に起因するレンダリングバグ群がまとめて修正され、Windows 環境での安定性が大幅に向上しました
- **メモリ管理の改善**: O(n²) のメッセージ蓄積解消と使用後のリソース解放により、長時間セッションでのメモリ効率が改善されました
- **エージェント並列処理の安定化**: 並列ファイル操作の独立性確保と、並列エージェント実行時の API エラー修正により、マルチエージェントワークフローの信頼性が向上しました
- **セキュリティ面の改善**: `bash` パーミッションクラシファイアのハルシネーション検証により、不正なパーミッション付与が防止されました
- **フック機能の強化**: `last_assistant_message` フィールドの追加により、フックスクリプトからの最終応答へのアクセスが簡単になりました

## まとめ

v2.1.47 は新機能よりも安定性と品質の向上に重点を置いたリリースです。特に Windows ユーザーへの影響が大きく、多数の Windows 固有のバグが一挙に修正されています。また、長時間・大規模なエージェントセッションでのメモリ使用量とパフォーマンスが改善され、実務での利用に際してより信頼性の高い動作が期待できます。バックグラウンドエージェント制御の `Ctrl+F` 変更など、操作体験の洗練も継続しています。
