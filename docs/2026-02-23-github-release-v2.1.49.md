---
title: "Claude Code v2.1.49 リリース — メモリリーク修正、パフォーマンス改善、ConfigChange フック追加"
date: 2026-02-23
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.49"
identifier: "v2.1.49"
---

# Claude Code v2.1.49 リリース — メモリリーク修正、パフォーマンス改善、ConfigChange フック追加

## 概要

Claude Code v2.1.49 では、長時間セッションにおける WASM メモリの無制限増大という重大なバグが修正され、複数のパフォーマンス改善が行われました。また、エンタープライズ向けのセキュリティ監査を可能にする `ConfigChange` フックや、SDK 向けのモデルケイパビリティ情報など、新機能も追加されています。Sonnet 4.5（1M context）が Max プランから削除され、Sonnet 4.6（1M context）へ移行するモデルの変更も含まれます。

## 新機能

### Simple モードでのファイル編集対応

`CLAUDE_CODE_SIMPLE` 環境変数で有効になる Simple モードに、Bash ツールに加えてファイル編集ツールが追加されました。これにより、制限されたモードでも直接ファイルを編集できるようになります。

### ConfigChange フックイベント

設定ファイルが変更された際に発火する新しいフックイベント `ConfigChange` が追加されました。エンタープライズ環境でのセキュリティ監査や、ポリシーに反する設定変更のブロックに活用できます。

```json
{
  "hooks": {
    "ConfigChange": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "your-audit-script.sh"
          }
        ]
      }
    ]
  }
}
```

### SDK モデル情報の拡張

SDK のモデル情報に以下の3つのフィールドが追加され、コンシューマーがモデルのケイパビリティをプログラムで検出できるようになりました。

- `supportsEffort` — effort レベルのサポート有無
- `supportedEffortLevels` — サポートされる effort レベルの一覧
- `supportsAdaptiveThinking` — Adaptive Thinking のサポート有無

### パーミッション提案の改善

safety チェックが ask レスポンスをトリガーした際に、パーミッションオプションが自動的に表示されるようになりました。SDK コンシューマーがユーザーにパーミッション選択肢を提示する際の実装が容易になります。

## 改善点

### スタートアップパフォーマンスの向上

複数の最適化によりスタートアップ時間が短縮されました。

- **非インタラクティブモード（`-p`）**: 起動時の不要な API 呼び出しをスキップ
- **MCP 認証失敗のキャッシュ**: 認証が必要なサーバーへの重複接続試行を回避
- **アナリティクストークンカウントの HTTP 呼び出し削減**: 不要なリクエストを削減
- **MCP ツールのトークンカウントをバッチ化**: 単一 API 呼び出しにまとめることで効率化

### パーミッションプロンプトの情報改善

パス安全チェックや作業ディレクトリブロックのパーミッションプロンプトに、制限の理由が表示されるようになりました。これまではコンテキストのない素っ気ないプロンプトが表示されていましたが、なぜ制限されているかが分かるようになります。

## バグ修正

### Ctrl+C / ESC がバックグラウンドエージェント実行中に無視される問題

バックグラウンドエージェントが実行中にメインスレッドがアイドル状態の場合、Ctrl+C および ESC が無視されていた問題が修正されました。3秒以内に2回押すと、すべてのバックグラウンドエージェントが強制終了されるようになります。

### WASM メモリの無制限増大

長時間セッションで発生していた2件のメモリリークが修正されました。

- **tree-sitter パーサーの定期リセット**: WASM メモリの無制限増大を防止
- **Yoga WASM リニアメモリの縮小**: Yoga レイアウトエンジンのメモリが長時間セッションで際限なく増大していた問題を解消

### その他のバグ修正

- **プロンプト提案キャッシュの回帰**: キャッシュヒット率が低下していた問題を修正
- **`plugin enable` / `plugin disable` のスコープ自動検出**: `--scope` 未指定時にユーザースコープへデフォルトされる代わりに、適切なスコープを自動検出するよう修正
- **verbose モードの表示更新**: `/config` でトグルした際に thinking ブロックの表示が更新されない問題を修正（memo コンパレーターが verbose の変化を正しく検出するよう修正）
- **stale な yoga レイアウト参照によるレンダリング問題を修正**
- **`disableAllHooks` 設定が管理設定階層を尊重するよう修正**: 非管理設定がポリシーで設定された管理フックを無効化できなくなりました（#26637）
- **`--resume` セッションピッカーの raw XML タグ表示を修正**: `/clear` 等のコマンドで始まるセッションで raw XML タグが表示されていた問題を修正

## Breaking Changes

### Sonnet 4.5（1M context）が Max プランから削除

Max プランにおいて Sonnet 4.5（1M context）が削除され、同等の 1M context を持つフロンティアモデル **Sonnet 4.6** に置き換えられます。現在 Sonnet 4.5 を使用している場合は、`/model` コマンドで Sonnet 4.6 へ切り替えてください。

## 技術的なポイント

- **長時間セッションの安定性**: tree-sitter と Yoga WASM の両方でメモリリークが修正されたことで、長時間稼働させるエージェントワークフローの信頼性が大幅に向上します
- **エンタープライズ対応の強化**: `ConfigChange` フックと `disableAllHooks` の管理設定階層対応により、組織でのポリシー管理がより堅牢になります
- **SDK 開発者向け**: モデルの `supportsEffort`、`supportedEffortLevels`、`supportsAdaptiveThinking` フィールドにより、動的なモデル選択や UI 制御の実装が容易になります
- **MCP サーバー運用**: 認証失敗のキャッシュによりスタートアップ時の無駄な接続試行が削減され、特に多数の MCP サーバーを設定している環境でメリットがあります
- **バックグラウンドエージェント**: Ctrl+C / ESC の二重押しによる強制終了は、並列エージェントを制御する際の重要な安全機能です

## まとめ

v2.1.49 は、長時間セッションの安定性向上とスタートアップパフォーマンスの改善に重点を置いたリリースです。特に WASM メモリリークの修正は、長時間稼働するエージェントワークフローを活用している開発者にとって重要な改善です。また、`ConfigChange` フックやモデルケイパビリティ情報の追加により、エンタープライズ利用と SDK 開発のユースケースが強化されました。Max プランの Sonnet 4.5 から Sonnet 4.6 への移行は、より高性能なモデルへのアップグレードとなりますので、対象ユーザーは早めに `/model` で切り替えを行うことをお勧めします。
