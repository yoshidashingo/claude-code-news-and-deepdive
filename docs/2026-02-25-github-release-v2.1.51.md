---
title: "Claude Code v2.1.51 リリース - remote-controlサブコマンド追加とセキュリティ修正"
date: 2026-02-25
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.51"
identifier: "v2.1.51"
---

# Claude Code v2.1.51 リリース - remote-controlサブコマンド追加とセキュリティ修正

## 概要

Claude Code v2.1.51 が2026年2月24日にリリースされました。本バージョンでは、外部ビルド向けの `claude remote-control` サブコマンドの追加、BashTool のパフォーマンス改善、コンテキストウィンドウの効率化が行われています。また、hook コマンドやHTTP hookに関わる複数のセキュリティ問題も修正されています。

## 新機能

### `claude remote-control` サブコマンド

外部ビルド向けに `claude remote-control` サブコマンドが新たに追加されました。このコマンドにより、すべてのユーザーがローカル環境をサーブする形で外部からの操作を受け付けることができます。CI/CD パイプラインや外部ツールと Claude Code を連携させるユースケースで活用できます。

### プラグインの npm カスタムレジストリ対応

npm ソースからプラグインをインストールする際に、カスタム npm レジストリの指定と特定バージョンのピン留めがサポートされました。社内レジストリや特定バージョンへの固定が必要な企業環境でのプラグイン管理が容易になります。

### `/model` ピッカーの人間が読みやすいラベル表示

`/model` コマンドのモデル選択画面で、これまで生のモデルID（例: `claude-sonnet-4-5-20251001`）が表示されていたのに対し、`Sonnet 4.5` のような人間が読みやすいラベルで表示されるようになりました。また、より新しいバージョンが利用可能な場合はアップグレードのヒントも表示されます。

### SDK向け環境変数の追加

SDK 利用者向けに、アカウント情報を同期的に提供するための環境変数が追加されました。

- `CLAUDE_CODE_ACCOUNT_UUID`
- `CLAUDE_CODE_USER_EMAIL`
- `CLAUDE_CODE_ORGANIZATION_UUID`

これらを設定することで、初期化直後のテレメトリーイベントにアカウントメタデータが欠落するレースコンディションが解消されます。

## 改善点

### BashTool のパフォーマンス向上

BashTool がシェルスナップショット利用可能時に、デフォルトでログインシェル（`-l` フラグ）をスキップするようになりました。以前はこの挙動を有効にするために `CLAUDE_BASH_NO_LOGIN=true` を明示的に設定する必要がありましたが、v2.1.51 からはデフォルトで適用されます。ログインシェルの初期化をスキップすることで、コマンド実行のオーバーヘッドが削減されます。

### ツール結果のディスク永続化しきい値の変更

ツール実行結果が大きい場合にディスクへ保存するしきい値が、100K 文字から **50K 文字**に変更されました。より積極的にディスクへオフロードすることで、コンテキストウィンドウの消費を抑え、長期間の会話での利用効率が向上します。

### プラグインマーケットプレイスの git タイムアウト延長

プラグインマーケットプレイスにおける git 操作のデフォルトタイムアウトが、30秒から **120秒**に延長されました。また、環境変数 `CLAUDE_CODE_PLUGIN_GIT_TIMEOUT_MS` を設定することで任意の値に変更することも可能です。ネットワーク環境が遅い場合にタイムアウトで失敗するケースが減ります。

## バグ修正

### セキュリティ修正: hook コマンドのワークスペーストラスト未確認問題

`statusLine` および `fileSuggestion` の hook コマンドが、インタラクティブモードでワークスペーストラストの承認なしに実行される可能性があった問題が修正されました。信頼されていないワークスペースで悪意ある hook が実行されるリスクが排除されています。

### セキュリティ修正: HTTP hook での環境変数インジェクション

HTTP hookのヘッダー値から任意の環境変数が展開（インジェクション）される可能性があった問題が修正されました。環境変数の展開には、hook 設定に **`allowedEnvVars` リストを明示的に定義**する必要があります。

既存の HTTP hook を使用している場合は、設定ファイルに `allowedEnvVars` を追加して必要な環境変数を許可リストに登録してください。

### セキュリティ修正: HTTP hook のサンドボックスネットワークプロキシ対応

サンドボックスが有効な環境では、HTTP hook がサンドボックスのネットワークプロキシを経由してルーティングされるようになり、ドメイン許可リストが適用されます。なお、HTTP hook は `SessionStart` / `Setup` イベントではサポートされません。

### WebSocket 再接続による重複メッセージ問題

WebSocket 再接続などにより `control_response` メッセージが重複して届いた場合に、会話に重複したアシスタントメッセージが積み重なって API 400 エラーが発生するバグが修正されました。

### スラッシュコマンドオートコンプリートのクラッシュ修正

プラグインの `SKILL.md` の description フィールドに YAML 配列やその他の非文字列型が記述されていた場合に、スラッシュコマンドのオートコンプリートがクラッシュする問題が修正されました。

## 技術的なポイント

- **BashTool のデフォルト動作変更**: シェルスナップショットが存在する場合、`-l`（ログインシェル）フラグがデフォルトでスキップされます。以前 `CLAUDE_BASH_NO_LOGIN=true` を設定していた場合、同等の挙動がデフォルトになります
- **HTTP hook の `allowedEnvVars` 必須化**: セキュリティ強化として、HTTP hookヘッダーで環境変数を展開するには明示的な許可リストが必要になりました。既存設定の見直しが必要な場合があります
- **ツール結果ディスクオフロードしきい値**: 50K 文字超のツール結果はディスクへ保存されます。長大な出力を返すツール（例: 大量ファイルの読み込み）を使用している場合、コンテキスト効率が改善されます
- **SDK 向けアカウント情報環境変数**: テレメトリーの正確性向上のため、SDK 組み込みの際は `CLAUDE_CODE_ACCOUNT_UUID` 等の環境変数を初期化時に設定することが推奨されます
- **`CLAUDE_CODE_PLUGIN_GIT_TIMEOUT_MS`**: プラグインの git タイムアウトを ms 単位で指定できます。低速ネットワーク環境では値を大きくすることでタイムアウトエラーを回避できます

## まとめ

v2.1.51 は、新機能として外部ビルド連携向けの `claude remote-control` サブコマンドやプラグインのカスタムレジストリ対応が追加されたほか、BashTool のデフォルト動作改善やコンテキストウィンドウの効率化など実用的な改善が多数含まれています。

セキュリティ面では、hook コマンドのワークスペーストラスト未確認問題と HTTP hook での環境変数インジェクション問題の修正が特に重要です。HTTP hook を利用している場合は、`allowedEnvVars` の設定を確認・追加する対応が必要になる場合があります。

全体として、安定性・セキュリティ・パフォーマンスの幅広い改善が施されたリリースとなっています。
