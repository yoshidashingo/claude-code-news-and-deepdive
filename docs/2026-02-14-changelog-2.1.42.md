---
title: "Claude Code v2.1.42 - パフォーマンス最適化とプロンプトキャッシュの改善"
date: 2026-02-14
source: changelog
source_url: "https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md"
identifier: "2.1.42"
---

# Claude Code v2.1.42 - パフォーマンス最適化とプロンプトキャッシュの改善

## 概要

Claude Code v2.1.42 では、起動パフォーマンスの向上とプロンプトキャッシュのヒット率改善に焦点を当てたアップデートが行われました。Zod スキーマ構築の遅延実行による起動速度の改善、システムプロンプトからの日付情報の分離によるキャッシュ効率の向上、そして Opus 4.6 ユーザー向けの新機能案内が追加されています。また、UI の表示に関する2つのバグが修正されました。

## 変更点の詳細

### パフォーマンス改善

#### 起動パフォーマンスの向上

Zod スキーマ構築を遅延実行することで、起動時のパフォーマンスが改善されました。Zod は TypeScript ファーストのスキーマ検証ライブラリで、Claude Code では API のレスポンスやユーザー入力の検証に使用されています。

従来は起動時にすべてのスキーマを一度に構築していましたが、このアップデートでは実際に必要になるまでスキーマの構築を遅延させる方式に変更されました。これにより、アプリケーション起動から最初のコマンド実行までの待ち時間が短縮され、ユーザー体験が向上します。

#### プロンプトキャッシュヒット率の改善

システムプロンプトから日付情報を移動することで、プロンプトキャッシュのヒット率が向上しました。プロンプトキャッシュは、Anthropic API の機能で、同じプロンプトを再利用することでレイテンシとコストを削減する仕組みです。

日付情報がシステムプロンプトに含まれていると、日付が変わるたびにキャッシュが無効化されてしまいます。日付情報を別の場所に移動することで、システムプロンプトの静的な部分をより長期間キャッシュできるようになり、API 呼び出しの効率が大幅に向上しました。

### 新機能

#### Opus 4.6 向けワンタイム案内

対象ユーザーに対して、Opus 4.6 に関する一回限りの案内が表示されるようになりました。この機能は、特定の条件を満たすユーザーにのみ表示される「effort callout」（注意喚起メッセージ）として実装されています。

Opus 4.6 は Anthropic の最新かつ最も高性能なモデルであり、Claude Code での利用が可能です。この案内により、ユーザーは新しいモデルの存在と利用方法を適切なタイミングで知ることができます。

### バグ修正

#### `/resume` コマンドの表示問題

`/resume` コマンドでセッションを再開する際、中断メッセージが適切なセッション識別子の代わりにタイトルとして表示されていた問題が修正されました。これにより、どのセッションを再開しようとしているのかが明確に分かるようになり、複数のセッションを管理する際の混乱が解消されます。

#### 画像サイズエラーメッセージの改善

画像の寸法制限エラーが発生した際、エラーメッセージに `/compact` コマンドの使用を提案するようになりました。Claude Code では大きすぎる画像を処理しようとするとエラーが発生しますが、`/compact` コマンドを使用することで画像を適切なサイズに圧縮して処理できます。

この改善により、ユーザーはエラーに直面した際に具体的な解決策を即座に知ることができ、トラブルシューティングの時間を短縮できます。

## 技術的なポイント

- **Zod スキーマの遅延実行**: パフォーマンス最適化の一般的なパターンである「遅延初期化（Lazy Initialization）」を採用。必要になるまでリソースの割り当てを遅らせることで、起動時間を短縮
- **プロンプトキャッシュの最適化**: 静的なコンテンツと動的なコンテンツを分離することで、キャッシュの有効期間を延長。これは API コストの削減とレスポンス速度の向上に直結
- **システムプロンプトの設計**: 日付のような頻繁に変わる情報をシステムプロンプトから分離することで、キャッシュ効率が大幅に向上。大規模言語モデルのアプリケーション設計における重要なベストプラクティス
- **ユーザー体験の向上**: エラーメッセージに具体的な解決策を含めることで、ユーザーが自己解決できる可能性が高まり、サポートコストも削減

## まとめ

v2.1.42 は、ユーザーから見えにくい部分での最適化を中心としたアップデートですが、日々の開発体験に直接影響する重要な改善が含まれています。起動速度の向上により、Claude Code をより素早く起動して作業を開始できるようになり、プロンプトキャッシュの改善により API レスポンスが高速化されます。

これらの最適化は、Claude Code の継続的な改善において、パフォーマンスと効率性を重視する開発チームの姿勢を示しています。特にプロンプトキャッシュの改善は、Anthropic API を使用する他のアプリケーションにとっても参考になる設計パターンと言えるでしょう。
