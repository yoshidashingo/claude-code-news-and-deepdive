---
title: "Claude Code v2.1.50 リリース：大規模なメモリリーク修正とワークツリー機能強化"
date: 2026-02-23
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.50"
identifier: "v2.1.50"
---

# Claude Code v2.1.50 リリース：大規模なメモリリーク修正とワークツリー機能強化

## 概要

Claude Code v2.1.50 は、長時間セッションでのメモリ安定性を大幅に改善した重要なリリースです。複数のメモリリーク修正と内部キャッシュの最適化により、長期使用時のメモリ使用量が削減されました。加えて、エージェントのワークツリー分離機能の強化や新しい CLI コマンドの追加など、開発体験を向上させる新機能も含まれています。

## 新機能

### `isolation: worktree` をエージェント定義でサポート

エージェント定義に `isolation: worktree` オプションが追加されました。これにより、エージェントが隔離された git worktree 上で実行されるよう宣言的に指定できるようになりました。複数エージェントが並列して作業する際の干渉を防ぎ、安全な並列実行環境を構築できます。

```json
{
  "agents": [
    {
      "name": "my-agent",
      "isolation": "worktree"
    }
  ]
}
```

### `WorktreeCreate` / `WorktreeRemove` フックイベント

エージェントのワークツリー分離機能と連携する新しいフックイベント `WorktreeCreate` と `WorktreeRemove` が追加されました。ワークツリーの作成・削除タイミングにカスタムスクリプトを実行できるため、独自の VCS セットアップやクリーンアップ処理を組み込むことが可能です。

### `claude agents` CLI コマンド

設定済みのエージェント一覧を表示する新しい CLI コマンドが追加されました。

```bash
claude agents
```

現在のプロジェクトに定義されているすべてのエージェントをリストアップでき、設定状況の確認が容易になります。

### `CLAUDE_CODE_DISABLE_1M_CONTEXT` 環境変数

1M コンテキストウィンドウのサポートを無効化する環境変数が追加されました。リソース制約のある環境や、意図的にコンテキスト長を制限したい場合に利用できます。

```bash
export CLAUDE_CODE_DISABLE_1M_CONTEXT=1
```

### Opus 4.6（高速モード）で 1M コンテキストウィンドウをサポート

Opus 4.6 の高速モードが完全な 1M コンテキストウィンドウに対応しました。大規模なコードベースや長い会話履歴を扱う場面でも、高速モードの恩恵を受けながら広いコンテキストを活用できます。

### LSP サーバーの `startupTimeout` 設定サポート

Language Server Protocol (LSP) サーバーの起動タイムアウトを設定できるようになりました。応答が遅い LSP サーバーを利用している環境での信頼性が向上します。

### VS Code `/extra-usage` コマンド対応

VS Code 拡張機能のセッションで `/extra-usage` コマンドが使用できるようになりました。

## 改善点

### `CLAUDE_CODE_SIMPLE` モードの強化

`CLAUDE_CODE_SIMPLE` 環境変数で有効化されるシンプルモードが大幅に強化されました。従来のスキル・セッションメモリ・カスタムエージェント・CLAUDE.md トークンカウントの削除に加え、以下の機能も無効化されるようになりました。

- MCP ツール
- アタッチメント
- フック
- CLAUDE.md ファイルの読み込み

これにより、完全に最小限の実行環境を構築できます。

### 長時間セッションのメモリ使用量最適化

長時間のセッションにおけるメモリ効率を改善する複数の最適化が導入されました。

- **圧縮後の内部キャッシュクリア**: セッションの圧縮処理後に不要な内部キャッシュをクリアします
- **大規模ツール結果の解放**: 処理済みの大きなツール結果をメモリから解放します
- **ファイル履歴スナップショットの上限設定**: 無制限に増加していたファイル履歴スナップショットに上限を設けます

### ヘッドレスモードの起動性能改善

`-p` フラグを使用したヘッドレスモードにおいて、Yoga WASM および UI コンポーネントのインポートを遅延実行するよう変更されました。ヘッドレスモードでは不要なモジュールの読み込みを後回しにすることで、起動性能が向上します。

## バグ修正

### シンボリックリンクを含むディレクトリでのセッション再開問題

作業ディレクトリにシンボリックリンクが含まれる場合に、再開したセッションが表示されないバグが修正されました。セッションストレージのパスが起動中の異なるタイミングで解決されていたことが原因でした。

また、SSH 切断時にセッションデータが失われる問題も修正されました。グレースフルシャットダウンシーケンスにおいて、フックとアナリティクスの前にセッションデータをフラッシュするよう変更されています。

### Linux での glibc 古いバージョンへの対応（RHEL 8 など）

glibc 2.30 より古いシステム（RHEL 8 等）でネイティブモジュールが読み込めなかった問題が修正されました。エンタープライズ環境での利用が改善されます。

### メモリリーク修正（複数箇所）

今回のリリースでは、特にメモリリーク対策が重点的に実施されています。

- **エージェントチームのメモリリーク**: 完了したチームメイトのタスクがセッション状態からガベージコレクションされていなかった問題を修正
- **AppState のタスク状態オブジェクト**: 完了したタスク状態オブジェクトが AppState から削除されていなかった問題を修正
- **LSP 診断データ**: 配信後の診断データが解放されず、長時間セッションでメモリが無制限に増加していた問題を修正
- **タスク出力**: 完了したタスクの出力がメモリから解放されていなかった問題を修正
- **CircularBuffer**: クリアされたアイテムがバッキング配列に保持され続けていた問題を修正
- **シェルコマンド実行**: クリーンアップ後も `ChildProcess` および `AbortController` の参照が保持されていた問題を修正

### `/mcp reconnect` のフリーズ修正

存在しないサーバー名を指定して `/mcp reconnect` コマンドを実行すると CLI がフリーズしていた問題が修正されました。

### MCP ツールの発見不具合修正

ツール検索が有効な状態で起動引数にプロンプトを渡した場合に、MCP ツールが発見されなかったバグが修正されました。

### プロンプト提案キャッシュの回帰修正

以前のバージョンで導入されたキャッシュヒット率の低下を引き起こす回帰バグが修正されました。

## 技術的なポイント

- **ワークツリー分離の宣言的設定**: `isolation: worktree` をエージェント定義に記述するだけで、エージェントの並列実行時の分離が保証されます。複雑なシェルスクリプトや手動設定が不要になります
- **メモリリーク対策の体系的な実施**: 今回のリリースでは 8 箇所以上のメモリリークが修正されています。長時間稼働する CI/CD 環境や自動化パイプラインでの安定性が大幅に向上します
- **`CLAUDE_CODE_SIMPLE` の完全なミニマル化**: MCP、フック、CLAUDE.md をすべて無効化することで、スクリプトから Claude Code を呼び出す際の予測可能な動作が保証されます
- **RHEL 8 サポート**: glibc 2.30 未満の環境への対応により、エンタープライズ Linux 環境での利用が可能になります
- **Opus 4.6 高速モードの 1M コンテキスト対応**: 速度と広いコンテキストウィンドウを同時に活用できるようになり、大規模プロジェクトでの作業効率が向上します

## まとめ

Claude Code v2.1.50 は、メモリ管理の徹底的な改善を中心とした安定性重視のリリースです。長時間セッションや多数のエージェントを並列実行するユースケースでの信頼性が大きく向上しました。また、ワークツリー分離の宣言的設定やフックイベントの追加により、複雑な自動化ワークフローの構築がより簡単になっています。

Opus 4.6 高速モードでの 1M コンテキストウィンドウ対応は、大規模コードベースを扱う開発者にとって特に注目すべき強化点です。RHEL 8 などのエンタープライズ Linux 環境への対応改善とあわせて、より広い環境での活用が期待されます。
