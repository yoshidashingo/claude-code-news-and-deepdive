---
title: "Claude Code v2.1.49 リリース — メモリリーク修正・ConfigChange Hook・スタートアップ高速化"
date: 2026-02-24
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.49"
identifier: "v2.1.49"
---

# Claude Code v2.1.49 リリース — メモリリーク修正・ConfigChange Hook・スタートアップ高速化

## 概要

Claude Code v2.1.49 は、長時間セッション中に発生するメモリリーク問題の修正を中心に、パフォーマンス改善・新機能追加・セキュリティ強化を含む幅広いアップデートです。エンタープライズ向けには `ConfigChange` Hook イベントの追加、SDK 利用者向けにはモデルケーパビリティ情報の拡張が行われています。また、Max プランでは Sonnet 4.6 が 1M context に対応し、Sonnet 4.5（1M context）との置き換えが実施されました。

## 新機能

### ConfigChange Hook イベント

セッション中に設定ファイルが変更された際に発火する `ConfigChange` Hook イベントが追加されました。この機能はエンタープライズ環境向けに設計されており、以下のユースケースに対応します。

- 設定変更のセキュリティ監査ログ記録
- 組織ポリシーに違反する設定変更のブロッキング

エンタープライズ管理者は、マネージド設定と組み合わせることで、ユーザーが意図しない設定変更を行った際にリアルタイムで検知・対応できるようになります。

### Simple Mode のファイル編集対応

`CLAUDE_CODE_SIMPLE` 環境変数で有効化できる Simple Mode に、Bash ツールに加えてファイル編集ツールが追加されました。これにより、Simple Mode でも直接ファイルを編集できるようになり、軽量な利用シナリオでの実用性が向上しました。

### Permission Suggestions の自動生成

セーフティチェックが ask レスポンスをトリガーした際、権限提案（Permission Suggestions）が自動的に生成されるようになりました。SDK コンシューマーはこの情報を使って、ユーザーに権限オプションを分かりやすく提示できます。

### SDK モデル情報の拡張

SDK のモデル情報に以下の新フィールドが追加されました。

| フィールド名 | 説明 |
|---|---|
| `supportsEffort` | Effort 制御のサポート有無 |
| `supportedEffortLevels` | サポートされる Effort レベルの一覧 |
| `supportsAdaptiveThinking` | Adaptive Thinking のサポート有無 |

SDK コンシューマーはこれらのフィールドを参照することで、モデルの機能を動的に検出し、対応する UI や処理を切り替えることができます。

## 改善点

### スタートアップパフォーマンスの向上

起動時間を短縮する複数の改善が実施されました。

- **非対話モード（`-p`）**: 起動時の不要な API 呼び出しをスキップし、パイプライン処理での高速化を実現
- **MCP 認証キャッシング**: HTTP および SSE MCP サーバーの認証失敗結果をキャッシングし、繰り返しの接続試行を回避
- **トークンカウントの最適化**: 分析用トークンカウントの HTTP コールを削減し、MCP ツールのトークンカウントを単一 API 呼び出しにバッチ処理

### 権限プロンプトの改善

パス安全性チェックやワーキングディレクトリブロック発動時の権限プロンプトに、制限の理由が表示されるようになりました。従来は理由のない bare なプロンプトが表示されていたため、ユーザーが状況を理解しにくい問題がありました。

### plugin コマンドのスコープ自動検出

`plugin enable` および `plugin disable` コマンドで `--scope` オプションを省略した場合、常にユーザースコープにデフォルト設定されていた挙動が修正されました。現在は適切なスコープを自動検出して適用します。

## バグ修正

### Ctrl+C / ESC が無視される問題

バックグラウンドエージェントが実行中でメインスレッドがアイドル状態のとき、`Ctrl+C` および `ESC` キー入力が無視される問題が修正されました。修正後は、3 秒以内に 2 回連続して押すとすべてのバックグラウンドエージェントが強制終了されます。

### プロンプト提案キャッシュの回帰

キャッシュヒット率が低下していたプロンプト提案キャッシュの回帰バグが修正されました。

### WASM メモリの無制限増加（2 件）

長時間セッション中に発生するメモリリークが 2 件修正されました。

- **tree-sitter パーサー**: WASM メモリの無制限増加を、パーサーの定期的なリセットによって解消
- **Yoga WASM**: レイアウト計算に使用する Yoga WASM のリニアメモリが縮小されない問題を修正

### Verbose モードの表示更新バグ

`/config` を使って Verbose モードをトグルした際、Thinking ブロックの表示が更新されない問題が修正されました。memo コンパレータが verbose 変更を正しく検出するようになりました。

### stale な yoga レイアウト参照によるレンダリング問題

古い yoga レイアウト参照が原因で発生する可能性があったレンダリング問題が修正されました。

### `--resume` セッションピッカーの XML タグ表示問題

`--resume` でセッション選択画面を表示した際、`/clear` などのコマンドで始まるセッションに対して生の XML タグが表示されていた問題が修正されました。現在はセッション ID のフォールバック表示に正しく切り替わります。

### `disableAllHooks` のセキュリティ修正

`disableAllHooks` 設定がマネージド設定の階層を尊重しない問題が修正されました（Issue [#26637](https://github.com/anthropics/claude-code/issues/26637)）。修正前は非マネージド設定から、組織ポリシーで設定されたマネージドフックを無効化できてしまう状態でした。修正後は、非マネージド設定がマネージドフックを上書きできなくなり、エンタープライズのセキュリティポリシーが適切に強制されます。

## モデルの変更

Max プランにおいて、**Sonnet 4.5（1M context）が削除**されました。後継として **Sonnet 4.6（1M context）** が利用可能となっています。

> Sonnet 4.5 を使用している場合は、`/model` コマンドで Sonnet 4.6 への切り替えを推奨します。

## 技術的なポイント

- **メモリ管理**: WASM ベースのライブラリ（tree-sitter、Yoga）はリニアメモリを使用するため、ガベージコレクションが効かず長時間稼働でリークしやすい。今回の修正でパーサーの定期リセットと Yoga のメモリ解放が実装された
- **エンタープライズ向け Hook**: `ConfigChange` Hook は `disableAllHooks` の修正と組み合わさり、組織のセキュリティポリシーをより確実に強制できる基盤が整った
- **SDK 拡張**: `supportsAdaptiveThinking` フィールドの追加により、Extended Thinking 機能を持つモデルをプログラム的に判別できるようになった
- **MCP キャッシング**: 認証失敗のキャッシングは、認証が必要な MCP サーバーを多数設定している環境でのスタートアップ時間を大幅に改善する
- **Simple Mode**: ファイル編集ツールの追加により、`CLAUDE_CODE_SIMPLE` モードが実用的な開発タスクに対応できる最小セットに近づいた

## まとめ

v2.1.49 は、長時間セッション中の安定性向上（メモリリーク修正）と起動速度の改善を中心に、エンタープライズ向けセキュリティ機能（`ConfigChange` Hook、`disableAllHooks` 修正）および SDK の機能拡張（モデルケーパビリティフィールド追加）が含まれます。特に WASM メモリリークの修正は、長時間利用するユーザーにとって体感できる改善となるでしょう。Max プランユーザーは `/model` コマンドで Sonnet 4.6 への移行を忘れずに確認してください。
