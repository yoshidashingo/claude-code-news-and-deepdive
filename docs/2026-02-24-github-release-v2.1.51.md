---
title: "Claude Code v2.1.51 リリース — remote-control サブコマンド追加、セキュリティ修正など"
date: 2026-02-24
source: github-release
source_url: "https://github.com/anthropics/claude-code/releases/tag/v2.1.51"
identifier: "v2.1.51"
---

# Claude Code v2.1.51 リリース — remote-control サブコマンド追加、セキュリティ修正など

## 概要

Claude Code v2.1.51 が2026年2月24日にリリースされました。今回のリリースでは、外部ビルド向けの `claude remote-control` サブコマンドの追加をはじめ、BashTool のパフォーマンス改善、2件のセキュリティ修正、複数のバグ修正が含まれています。SDK 利用者向けに新しい環境変数も追加され、テレメトリの信頼性向上にも取り組んでいます。

## 新機能

### `claude remote-control` サブコマンド

外部ビルド（external builds）向けに `claude remote-control` サブコマンドが追加されました。これにより、全ユーザーがローカル環境のサーバーを利用できるようになります。CI/CD パイプラインや外部ツールから Claude Code の機能を呼び出す際に活用できます。

### カスタム npm レジストリとバージョンピニングのサポート

npm ソースからプラグインをインストールする際に、カスタム npm レジストリの指定と特定バージョンのピニングがサポートされました。プライベートレジストリを使用している企業環境や、再現性の高いビルドが必要な場面で有用です。

### `/model` ピッカーの UI 改善

`/model` コマンドで表示されるモデル選択画面が改善されました。これまでは生のモデル ID（例: `claude-sonnet-4-5-20251022`）が表示されていましたが、今後は人間が読みやすいラベル（例: `Sonnet 4.5`）で表示されます。また、ピン留めしているモデルより新しいバージョンが利用可能な場合はアップグレードのヒントも表示されます。

### SDK 向け新環境変数

SDK 呼び出し元がアカウント情報を同期的に提供できるよう、以下の環境変数が追加されました。

- `CLAUDE_CODE_ACCOUNT_UUID`
- `CLAUDE_CODE_USER_EMAIL`
- `CLAUDE_CODE_ORGANIZATION_UUID`

これまでは初期テレメトリイベントの送信時にアカウントメタデータの取得が間に合わない競合状態（race condition）が発生していました。これらの環境変数を利用することで、起動直後からアカウント情報をテレメトリに含めることができます。

## 改善点

### BashTool のパフォーマンス向上

シェルスナップショットが利用可能な場合、BashTool はデフォルトでログインシェル（`-l` フラグ）をスキップするようになりました。これにより、コマンド実行のオーバーヘッドが削減されます。

従来はこの挙動を有効にするために環境変数の設定が必要でした。

```bash
# 以前は明示的な設定が必要だった
export CLAUDE_BASH_NO_LOGIN=true
```

v2.1.51 からはシェルスナップショットが存在する場合に自動的にスキップされます。

### プラグインマーケットプレイスの Git タイムアウト延長

プラグインマーケットプレイスでの Git 操作のデフォルトタイムアウトが 30 秒から 120 秒に延長されました。ネットワーク遅延が大きい環境でのプラグインインストール失敗が減少することが期待されます。タイムアウト値は環境変数 `CLAUDE_CODE_PLUGIN_GIT_TIMEOUT_MS` でカスタマイズできます。

```bash
# タイムアウトを 180 秒に設定する例
export CLAUDE_CODE_PLUGIN_GIT_TIMEOUT_MS=180000
```

### ツール結果の永続化閾値の引き下げ

ツールの実行結果をディスクに永続化する閾値が 100K 文字から 50K 文字に引き下げられました。より積極的に大きなツール結果をディスクに逃がすことで、コンテキストウィンドウの消費を抑え、長時間にわたる会話の継続性を向上させます。

### HTTP フックのサンドボックス対応

サンドボックスが有効な場合、HTTP フックがサンドボックスのネットワークプロキシ経由でルーティングされるようになりました。これによりドメインのアローリストが HTTP フックにも適用されます。なお、HTTP フックは `SessionStart` / `Setup` イベントには対応していません。

## バグ修正

### WebSocket 再接続時の重複メッセージ問題

WebSocket の再接続などにより `control_response` メッセージが重複して送信された場合、会話履歴に重複したアシスタントメッセージが追加され、API が 400 エラーを返すことがありました。この問題が修正されました。

### スラッシュコマンドオートコンプリートのクラッシュ

プラグインの `SKILL.md` に記述された description が YAML 配列やその他の文字列以外の型である場合、スラッシュコマンドのオートコンプリートがクラッシュしていました。この問題が修正され、非文字列型の description が含まれる場合でもクラッシュしないようになりました。

## セキュリティ修正

### フック実行時のワークスペーストラスト検証の欠如（修正済み）

`statusLine` および `fileSuggestion` フックコマンドが、対話型モードでワークスペーストラストの受け入れなしに実行できてしまう問題が修正されました。信頼されていないワークスペースでフックが意図せず実行されるリスクが排除されています。

### HTTP フックによる任意環境変数の補間（修正済み）

HTTP フックのヘッダー値から任意の環境変数を補間できてしまうセキュリティ上の問題が修正されました。環境変数の補間を行うには、フック設定で `allowedEnvVars` リストに明示的に許可する変数名を列挙する必要があります。

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "type": "http",
        "url": "https://example.com/hook",
        "headers": {
          "X-Custom-Header": "${MY_VAR}"
        },
        "allowedEnvVars": ["MY_VAR"]
      }
    ]
  }
}
```

この変更により、フック設定を悪意のある値で上書きされた場合でも、意図しない環境変数の漏洩を防ぐことができます。

## 技術的なポイント

- **`claude remote-control`** は外部ビルドシステムとの統合を念頭に置いた新サブコマンドで、CI/CD パイプラインでの活用が期待される
- **BashTool のログインシェルスキップ**はシェルスナップショットの存在を条件とするため、スナップショットが存在しない環境では従来通りの動作となる
- **HTTP フックのセキュリティ強化**は `allowedEnvVars` を必須化する破壊的変更を含む可能性があるため、HTTP フックを使用している場合は設定の見直しが必要
- **ツール結果の永続化閾値削減**（100K → 50K）はコンテキスト効率の観点から重要で、特に大量のファイル操作やコード生成を行う長時間セッションに効果的
- **SDK 向け環境変数**はテレメトリの精度向上に直結し、組織での利用状況を正確に把握するうえで有用

## まとめ

v2.1.51 は新機能の追加と並行してセキュリティ修正を2件含む重要なリリースです。特に HTTP フックの環境変数補間に関するセキュリティ修正は、既存の設定に影響を与える可能性があるため、HTTP フックを使用しているユーザーは `allowedEnvVars` の設定を確認することをおすすめします。BashTool のパフォーマンス改善やツール結果の永続化閾値の引き下げにより、長時間の作業セッションでもより快適に Claude Code を利用できるようになります。`claude remote-control` サブコマンドの追加は、CI/CD や外部ツールとの統合を検討している開発者にとって注目の機能です。
